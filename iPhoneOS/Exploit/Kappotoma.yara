rule Exploit_iPhoneOS_Kappotoma_A_2147743475_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:iPhoneOS/Kappotoma.A"
        threat_id = "2147743475"
        type = "Exploit"
        platform = "iPhoneOS: "
        family = "Kappotoma"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACHOHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "/var/mobile/Library/Caches/com.saurik.Cydia" ascii //weight: 1
        $x_1_2 = "/etc/apt/sources.list.d/electra.list" ascii //weight: 1
        $x_1_3 = "/usr/lib/libjailbreak.dylib" ascii //weight: 1
        $x_1_4 = "/.bootstrapped_electra" ascii //weight: 1
        $x_1_5 = "/.cydia_no_stash" ascii //weight: 1
        $x_1_6 = "/Library/LaunchDaemons/jailbreakd.plist" ascii //weight: 1
        $x_1_7 = " [-] failed to send message %x (%d): %s" ascii //weight: 1
        $x_1_8 = "/var/log/jailbreakd-stdout.log" ascii //weight: 1
        $x_1_9 = "/var/log/jailbreakd-stderr.log" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        ((uint32(0) == 0xfeedfacf) or (uint32(0) == 0xcffaedfe) or (uint32(0) == 0xfeedface) or (uint32(0) == 0xcefaedfe)) and
        (6 of ($x*))
}

rule Exploit_iPhoneOS_Kappotoma_D_2147751009_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:iPhoneOS/Kappotoma.D"
        threat_id = "2147751009"
        type = "Exploit"
        platform = "iPhoneOS: "
        family = "Kappotoma"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACHOHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "_set_exploit_strategy" ascii //weight: 1
        $x_1_2 = "cydia.zodttd.com" ascii //weight: 1
        $x_1_3 = "machswap2_exploit" ascii //weight: 1
        $x_1_4 = "JailbreakViewController.m" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        ((uint32(0) == 0xfeedfacf) or (uint32(0) == 0xcffaedfe) or (uint32(0) == 0xfeedface) or (uint32(0) == 0xcefaedfe)) and
        (2 of ($x*))
}

rule Exploit_iPhoneOS_Kappotoma_B_2147751118_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:iPhoneOS/Kappotoma.B"
        threat_id = "2147751118"
        type = "Exploit"
        platform = "iPhoneOS: "
        family = "Kappotoma"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACHOHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "9PBE2V566X.com.rreman168.cn" ascii //weight: 1
        $x_1_2 = "kport.ip_kobject=%p" ascii //weight: 1
        $x_1_3 = "Error: exploit. Reboot and retry." ascii //weight: 1
        $x_1_4 = "jailbreak365 and CoryKornowicz" ascii //weight: 1
        $x_1_5 = "Exploit selected: v3ntex" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        ((uint32(0) == 0xfeedfacf) or (uint32(0) == 0xcffaedfe) or (uint32(0) == 0xfeedface) or (uint32(0) == 0xcefaedfe)) and
        (2 of ($x*))
}

rule Exploit_iPhoneOS_Kappotoma_C_2147751129_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:iPhoneOS/Kappotoma.C"
        threat_id = "2147751129"
        type = "Exploit"
        platform = "iPhoneOS: "
        family = "Kappotoma"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_MACHOHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "com.lake.research.rootKit" ascii //weight: 1
        $x_1_2 = "PostExploit/vouncher_swap/voucher_swap/log.c" ascii //weight: 1
        $x_1_3 = "Starting Exploiting... using voucher_swap method." ascii //weight: 1
        $x_1_4 = "9F3ED5X4UJ" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        ((uint32(0) == 0xfeedfacf) or (uint32(0) == 0xcffaedfe) or (uint32(0) == 0xfeedface) or (uint32(0) == 0xcefaedfe)) and
        (2 of ($x*))
}

rule Exploit_iPhoneOS_Kappotoma_E_2147751626_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:iPhoneOS/Kappotoma.E!MTB"
        threat_id = "2147751626"
        type = "Exploit"
        platform = "iPhoneOS: "
        family = "Kappotoma"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACHOHSTR_EXT"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "GetKeychainItemsOfSecClass" ascii //weight: 1
        $x_1_2 = "GetCurrentTimeWithFormat" ascii //weight: 1
        $x_1_3 = "GetIOSVersion" ascii //weight: 1
        $x_1_4 = "GetSerialNumber" ascii //weight: 1
        $x_1_5 = "GetDeviceName" ascii //weight: 1
        $x_1_6 = "IsLockscreenOn" ascii //weight: 1
        $x_1_7 = "Performing exploitation.." ascii //weight: 1
        $x_1_8 = "Exploited successfully" ascii //weight: 1
        $x_1_9 = "exploit started" ascii //weight: 1
        $x_1_10 = "Finished exploitation, going to get advanced privileges." ascii //weight: 1
        $x_1_11 = "iPhone Developer: iiedev@icloud.com (7F43FFAUF4)" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        ((uint32(0) == 0xfeedfacf) or (uint32(0) == 0xcffaedfe) or (uint32(0) == 0xfeedface) or (uint32(0) == 0xcefaedfe)) and
        (8 of ($x*))
}

rule Exploit_iPhoneOS_Kappotoma_F_2147755507_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:iPhoneOS/Kappotoma.F!MTB"
        threat_id = "2147755507"
        type = "Exploit"
        platform = "iPhoneOS: "
        family = "Kappotoma"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACHOHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "update.93.pangu.io/jb" ascii //weight: 1
        $x_1_2 = "/tmp/.pangu93loaded" ascii //weight: 1
        $x_1_3 = "Jailbreak succeeded" ascii //weight: 1
        $x_1_4 = "io.pangu93.loader.plist" ascii //weight: 1
        $x_1_5 = "com.wanmei.mini.condorpp-532-8" ascii //weight: 1
        $x_1_6 = "Cydia://" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        ((uint32(0) == 0xfeedfacf) or (uint32(0) == 0xcffaedfe) or (uint32(0) == 0xfeedface) or (uint32(0) == 0xcefaedfe)) and
        (all of ($x*))
}

