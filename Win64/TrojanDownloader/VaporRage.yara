rule TrojanDownloader_Win64_VaporRage_D_2147806297_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:Win64/VaporRage.D!dha"
        threat_id = "2147806297"
        type = "TrojanDownloader"
        platform = "Win64: Windows 64-bit platform"
        family = "VaporRage"
        severity = "Critical"
        info = "dha: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {48 31 e0 48 [0-36] 0f be ?? ?? ?? ?? 00 83 f0 ?? 66 89 ?? 66 89 ?? ?? ?? 0f be ?? ?? ?? ?? 00 83 f0 ?? 66 89 ?? 66 89 ?? ?? ?? 0f be ?? ?? ?? ?? 00 83 f0 ?? 66 89 ?? 66 89 ?? ?? ?? 0f be ?? ?? ?? ?? 00}  //weight: 1, accuracy: Low
        $x_1_2 = {48 31 e0 48 [0-36] 0f be ?? ?? ?? ?? 00 83 f0 ?? 88 ?? 88 ?? ?? ?? 0f be ?? ?? ?? ?? 00 83 f0 ?? 88 ?? 88 ?? ?? ?? 0f be ?? ?? ?? ?? 00 83 f0 ?? 88 ?? 88 ?? ?? ?? 0f be ?? ?? ?? ?? 00}  //weight: 1, accuracy: Low
        $x_1_3 = {48 31 e0 48 ?? ?? ?? ?? ?? 00 00 [0-64] 0f be ?? ?? ?? ?? 00 83 f0 ?? 88 ?? 88 ?? ?? ?? ?? 00 00 0f be ?? ?? ?? ?? 00 83 f0 ?? 88 ?? 88 ?? ?? ?? ?? 00 00 0f be ?? ?? ?? ?? 00 83 f0 ?? 88 ?? 88 ?? ?? ?? ?? 00 00 0f be ?? ?? ?? ?? 00}  //weight: 1, accuracy: Low
        $x_1_4 = {49 31 e2 4c 89 ?? ?? ?? ?? 00 00 [0-80] 0f be ?? ?? ?? ?? 00 83 f0 ?? 88 ?? 88 ?? ?? ?? ?? 00 00 0f be ?? ?? ?? ?? 00 83 f0 ?? 88 ?? 88 ?? ?? ?? ?? 00 00 0f be ?? ?? ?? ?? 00}  //weight: 1, accuracy: Low
        $x_1_5 = {48 31 e7 48 ?? ?? ?? ?? ?? 00 00 44 89 db 81 e3 ?? ?? ?? ?? 89 9c ?? ?? ?? 00 00 8b 9c ?? ?? ?? 00 00 44 89 ?? 81 e5 ?? ?? ?? ?? 89 ac ?? ?? ?? 00 00 8b ac ?? ?? ?? 00 00 45 89 ?? 41 ?? ?? ?? ?? ?? ?? 44 89 b4 ?? ?? ?? 00 00 44 8b b4 ?? ?? ?? 00 00 41 c1 e6 ?? 44 89 b4 ?? ?? ?? 00 00 03 ac 24 ?? ?? 00 00}  //weight: 1, accuracy: Low
        $x_1_6 = {48 31 e7 48 ?? ?? ?? ?? ?? 00 00 [0-96] 0f be ?? ?? ?? ?? 00 83 f0 ?? 88 ?? 88 8c ?? ?? ?? 00 00 0f be ?? ?? ?? ?? 00 83 f0 ?? 88 ?? 88 8c ?? ?? ?? 00 00 0f be ?? ?? ?? ?? 00 83 f0 ?? 88 ?? 88 8c ?? ?? ?? 00 00}  //weight: 1, accuracy: Low
        $x_1_7 = {48 31 e6 48 89 ?? ?? ?? ?? 00 00 [0-96] 0f be ?? ?? ?? ?? 00 83 f0 ?? 88 ?? 88 8c ?? ?? ?? 00 00 0f be ?? ?? ?? ?? 00 83 f0 ?? 88 ?? 88 8c ?? ?? ?? 00 00 0f be ?? ?? ?? ?? 00 83 f0 ?? 88 ?? 88 8c ?? ?? ?? 00 00 0f be ?? ?? ?? ?? 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (3 of ($x*))
}

rule TrojanDownloader_Win64_VaporRage_N_2147897444_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:Win64/VaporRage.N!dha"
        threat_id = "2147897444"
        type = "TrojanDownloader"
        platform = "Win64: Windows 64-bit platform"
        family = "VaporRage"
        severity = "Critical"
        info = "dha: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "100"
        strings_accuracy = "High"
    strings:
        $x_100_1 = {31 c0 49 89 c9 48 39 d0 74 19 48 89 c1 4d 89 c2 83 e1 07 48 c1 e1 03 49 d3 ea 45 30 14 01 48 ff c0 eb e2 c3}  //weight: 100, accuracy: High
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

rule TrojanDownloader_Win64_VaporRage_H_2147897446_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:Win64/VaporRage.H!dha"
        threat_id = "2147897446"
        type = "TrojanDownloader"
        platform = "Win64: Windows 64-bit platform"
        family = "VaporRage"
        severity = "Critical"
        info = "dha: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "100"
        strings_accuracy = "Low"
    strings:
        $x_100_1 = {48 8b 45 10 49 b8 82 38 ba 4d f7 57 3c b8 ba ?? ?? ?? ?? 48 89 c1 e8}  //weight: 100, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

