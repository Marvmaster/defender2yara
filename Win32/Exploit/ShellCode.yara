rule Exploit_Win32_ShellCode_T_2147618436_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/ShellCode.T"
        threat_id = "2147618436"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "ShellCode"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "1"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {d9 e1 d9 34 24 58 58 58 58 33 db b3 ?? 03 c3 31 c9 66 81 e9 ?? ?? 80 30 ?? 40 e2 fa}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

rule Exploit_Win32_ShellCode_A_2147625233_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/ShellCode.gen!A"
        threat_id = "2147625233"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "ShellCode"
        severity = "Critical"
        info = "gen: malware that is detected using a generic signature"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {e8 ff ff ff ff c0 5e 81 76 ?? ?? ?? ?? ?? 83 ee ?? e2 f4}  //weight: 1, accuracy: Low
        $x_1_2 = {53 4d 42 72 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

rule Exploit_Win32_ShellCode_B_2147638053_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/ShellCode.gen!B"
        threat_id = "2147638053"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "ShellCode"
        severity = "Critical"
        info = "gen: malware that is detected using a generic signature"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {81 e9 aa aa aa aa d9 ee d9 74 24 f4 5b 80 73 0e ?? 43 e2 f9 05 00 b9 ?? ?? aa aa}  //weight: 1, accuracy: Low
        $x_1_2 = {00 5c 00 2e 00 2e 00 5c 00 2e 00 2e 00 5c 00 90 90 90 90 90 90 90 90}  //weight: 1, accuracy: High
        $x_1_3 = {e8 01 00 00 00 90 58 8b d8 2b dc 85 db 79 05 83 ec ?? eb f3 fc 6a ?? 4d e8 ?? ff ff ff 60 8b 6c 24 24}  //weight: 1, accuracy: Low
        $x_1_4 = {8b 34 8b 03 f5 33 c0 99 ac 84 c0 74 07 c1 ca ?? 03 d0 eb f4 3b 54 24 28 75 ?? 8b 5f 24 03 dd}  //weight: 1, accuracy: Low
        $x_2_5 = {64 a1 30 00 00 00 8b 40 0c 8b 70 1c ad 8b 58 08 5e 68 8e 4e 0e ec ?? ff d6 68 6f 6e 00 00 68 75 72 6c 6d 54 ff ?? 68 36 1a 2f 70 50 ff}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (
            ((2 of ($x_1_*))) or
            ((1 of ($x_2_*))) or
            (all of ($x*))
        )
}

rule Exploit_Win32_ShellCode_AC_2147683320_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/ShellCode.AC"
        threat_id = "2147683320"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "ShellCode"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "100"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {81 7c 18 fc 4c 6f 77 5c 74 02 75 09 c6 86 99 00 00 00 01 eb 07 c6 86 99 00 00 00 00}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

rule Exploit_Win32_ShellCode_AD_2147694690_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/ShellCode.AD"
        threat_id = "2147694690"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "ShellCode"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {77 69 6e 69 c7 [0-3] 6e 65 74 2e c7 [0-3] 64 6c 6c 00}  //weight: 1, accuracy: Low
        $x_1_2 = {4c 77 26 07 [0-4] e8}  //weight: 1, accuracy: Low
        $x_1_3 = {b9 58 a4 53 e5 8b d8 e8 ?? ?? ?? ?? 6a 40 68 00 10 00 00 68 00 00 10 00 33 f6 56 ff d0}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

rule Exploit_Win32_ShellCode_AD_2147694690_1
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/ShellCode.AD"
        threat_id = "2147694690"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "ShellCode"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {89 6c 24 24 ff 54 24 48 8b 44 24 14 6a 40 68 00 30 00 00 40 50 57 6a ff ff 54 24 34}  //weight: 1, accuracy: High
        $x_1_2 = {77 69 6e 69 c7 [0-3] 6e 65 74 2e c7 [0-3] 64 6c 6c 00}  //weight: 1, accuracy: Low
        $x_1_3 = {70 6f 77 65 c7 [0-3] 72 73 68 65 c7 [0-3] 6c 6c 20 2d}  //weight: 1, accuracy: Low
        $x_1_4 = {3a 56 79 a7 [0-12] e8}  //weight: 1, accuracy: Low
        $x_1_5 = {4c 77 26 07 [0-4] e8}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (4 of ($x*))
}

rule Exploit_Win32_ShellCode_AD_2147694690_2
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/ShellCode.AD"
        threat_id = "2147694690"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "ShellCode"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2e 64 6c 6c 88 44 24 ?? c7 44 24 ?? 77 69 6e 69}  //weight: 1, accuracy: Low
        $x_1_2 = {6c 2e 64 6c 66 c7 44 24 ?? 6c 00 c7 [0-6] 68 74 74 70 c7}  //weight: 1, accuracy: Low
        $x_1_3 = {6e 65 74 2e c7 44 24 ?? 64 6c 6c 00 c7 44 24 ?? 68 74 74 70}  //weight: 1, accuracy: Low
        $x_1_4 = {b9 3a 56 79 a7 e8 ?? ?? ?? ?? b9 77 87 7a f0}  //weight: 1, accuracy: Low
        $x_1_5 = "x:Class=\"esilver.App\"" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (4 of ($x*))
}

rule Exploit_Win32_ShellCode_AD_2147694690_3
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/ShellCode.AD"
        threat_id = "2147694690"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "ShellCode"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_ARHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {89 6c 24 24 ff 54 24 48 8b 44 24 14 6a 40 68 00 30 00 00 40 50 57 6a ff ff 54 24 34}  //weight: 1, accuracy: High
        $x_1_2 = {77 69 6e 69 c7 [0-3] 6e 65 74 2e c7 [0-3] 64 6c 6c 00}  //weight: 1, accuracy: Low
        $x_1_3 = {70 6f 77 65 c7 [0-3] 72 73 68 65 c7 [0-3] 6c 6c 20 2d}  //weight: 1, accuracy: Low
        $x_1_4 = {3a 56 79 a7 [0-12] e8}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Win32_ShellCode_AE_2147712055_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/ShellCode.AE"
        threat_id = "2147712055"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "ShellCode"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {c7 44 24 48 6b 65 72 6e c7 44 24 4c 65 6c 33 32}  //weight: 1, accuracy: High
        $x_1_2 = {c6 45 c9 77 c6 45 ca 62 c6 45 cb 65}  //weight: 1, accuracy: High
        $x_1_3 = {c6 45 a0 70 c6 45 a1 6f c6 45 a2 77}  //weight: 1, accuracy: High
        $x_1_4 = {c7 45 f8 2e 65 78 65 c6 45 fc 00 8d 55 f8 84 c0 74 25 57 8b fa 8b f1 2b f7 5f 3c 2e}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (3 of ($x*))
}

rule Exploit_Win32_ShellCode_AE_2147712055_1
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/ShellCode.AE"
        threat_id = "2147712055"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "ShellCode"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_ARHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {c7 44 24 48 6b 65 72 6e c7 44 24 4c 65 6c 33 32}  //weight: 1, accuracy: High
        $x_1_2 = {c6 45 c9 77 c6 45 ca 62 c6 45 cb 65}  //weight: 1, accuracy: High
        $x_1_3 = {c6 45 a0 70 c6 45 a1 6f c6 45 a2 77}  //weight: 1, accuracy: High
        $x_1_4 = {c7 45 f8 2e 65 78 65 c6 45 fc 00 8d 55 f8 84 c0 74 25 57 8b fa 8b f1 2b f7 5f 3c 2e}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule Exploit_Win32_ShellCode_MR_2147773168_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/ShellCode.MR!MTB"
        threat_id = "2147773168"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "ShellCode"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {33 d0 c7 05 [0-8] 8b d2 01 15 [0-4] a1 [0-4] 8b 0d [0-4] 89 08 5d c3 05 00 a1}  //weight: 1, accuracy: Low
        $x_1_2 = {8b f8 03 3d [0-4] 68 [0-4] ff 15 [0-4] 03 [0-5] 8b [0-5] 8a [0-3] 88 [0-3] 8b [0-5] 83 [0-3] 89 [0-5] eb}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

rule Exploit_Win32_ShellCode_RA_2147773656_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/ShellCode.RA!MTB"
        threat_id = "2147773656"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "ShellCode"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {c1 ea 05 89 54 24 ?? c7 05 ?? ?? ?? ?? 2e ce 50 91 8b 44 24 ?? 01 44 24 ?? 81 3d ?? ?? ?? ?? 12 09 00 00 75}  //weight: 1, accuracy: Low
        $x_1_2 = {33 f7 31 74 24 ?? 8b 44 24 ?? 29 44 24 ?? 81 3d ?? ?? ?? ?? 26 04 00 00 75}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

