rule Exploit_Win32_MS07065_2147601151_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/MS07065"
        threat_id = "2147601151"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "MS07065"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "Low"
    strings:
        $x_5_1 = {05 00 0b 03 10 00 00 00 48 00 00 00 01 00 00 00 d0 16 d0 16 00 00 00 00 01 00 00 00 00 00 01 00 30 a0 b3 fd 5f 06 d1 11 bb 9b 00 a0 24 ea 55 25 01 00 00 00 04 5d 88 8a eb 1c c9 11 9f e8 08 00 2b 10 48 60 02 00 00 00}  //weight: 5, accuracy: High
        $x_1_2 = {05 00 00 81 10 00 00 00 d0 16 00 00 01 00 00 00 98 17 00 00 00 00 06 00 30 a0 b3 fd 5f 06 d1 11 bb 9b 00 a0 24 ea 55 25 01 00 00 00 ba 0b 00 00 00 00 00 00 ba 0b 00 00 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 00 cc ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? (41) (41) ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? (41) (41) eb 06 42 42 32 b0 01 78 2b c9 83 e9 b0 d9 ee d9 74 24 f4 5b 81 73 13 1d 82 67 b4 83 eb fc e2 f4 e1 e8 8c f9 f5 7b 98 4b e2 e2 ec d8 39 a6 ec f1 21 09 1b b1 65 83 88 3f 52 9a ec eb 3d 83 8c fd 96 b6 ec b5 f3 b3 a7 2d b1 06 a7 c0 1a 43 ad b9 1c 40 8c 40 26 d6 43 9c 68 67 ec eb 39 83 8c d2 96 8e 2c 3f 42 9e 66 5f 1e ae ec 3d 71 a6 7b d5 de b3 bc d0 96 c1 57 3f 5d 8e ec c4 01 2f ec f4 15 dc 0f 3a 53 8c 8b e4 e2 54 01 e7 7b}  //weight: 1, accuracy: Low
        $x_1_3 = {ea 54 86 75 f5 14 86 42 d6 98 64 75 49 8a 48 26 d2 98 62 42 0b 82 d2 9c 6f 6f b6 48 e8 65 4b cd ea be bd e8 2f 30 4b cb d1 34 e7 4e d1 24 e7 5e d1 98 64 7b ea 63 36 7b d1 ee 55 88 ea c3 ae 6d 45 30 4b cb e8 77 e5 48 7d b7 dc b9 2f 49 5d 4a 7d b1 e7 48 7d b7 dc f8 cb e1 fd 4a 7d b1 e4 49 d6 32 4b cd 11 0f 53 64 44 1e e3 e2 54 32 4b cd e4 0d d0 7b ea 04 d9 94 67 0d e4 44 ab ab 3d fa e8 23 3d ff b3 a7 47 b7 7c 25 99 e3 c0 4b 27 90 f8 5f 1f b6 29 0f c6 e3 31 71 4b 68 c6 98 62 46 d5 35 e5 4c d3 0d b5 4c d3 32 e5 e2 52 0f 19 c4 87 a9 e7 e2 54 0d 4b e2 b5 98 64 96 d5 9b 37 d9 e6 98 62 4f 7d b7 dc f2 4c 87 d4 4e 7d b1 4b cd 82 67 b4 41 41 41 41 41 41}  //weight: 1, accuracy: High
        $x_1_4 = {05 00 00 82 10 00 00 00 18 01 00 00 01 00 00 00 f0 00 00 00 00 00 06 00 30 a0 b3 fd 5f 06 d1 11 bb 9b 00 a0 24 ea 55 25 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? (41) (41) 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (
            ((1 of ($x_5_*) and 2 of ($x_1_*))) or
            (all of ($x*))
        )
}

