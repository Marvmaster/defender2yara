rule Exploit_Win32_CVE_2016_0040_B_2147730014_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/CVE-2016-0040.B!bit"
        threat_id = "2147730014"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "CVE-2016-0040"
        severity = "Critical"
        info = "bit: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {57 60 8b 15 ?? ?? ?? 00 64 8b 02 8b 15 ?? ?? ?? 00 8b 04 10 8b c8 8b 35 ?? ?? ?? 00 ba 04 00 00 00 8b 3d ?? ?? ?? 00 8b 1d ?? ?? ?? 00 8b 04 38 2b c7 39 14 18 75 f6 8b 14 30 89 14 31 61}  //weight: 1, accuracy: Low
        $x_1_2 = {50 68 44 81 22 00 56 ff 15 ?? ?? ?? 00 85 c0}  //weight: 1, accuracy: Low
        $x_1_3 = "MS16-014 exploit by skyer" ascii //weight: 1
        $x_1_4 = "Example: exp.exe \"net user admin admin /ad\"" ascii //weight: 1
        $x_1_5 = "\\\\.\\WMIDataDevice" ascii //weight: 1
        $x_1_6 = "Trying to execute %s as SYSTEM" wide //weight: 1
        $x_1_7 = "\\ms16-014\\Release\\ms16-014.pdb" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (5 of ($x*))
}

