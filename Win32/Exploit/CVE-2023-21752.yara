rule Exploit_Win32_CVE_2023_21752_B_2147901745_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/CVE-2023-21752.B"
        threat_id = "2147901745"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "CVE-2023-21752"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {83 c4 1c 6a 00 50 6a 00 6a 00 8d 46 08 8b 74 24 28 50 56 68 a4 00 09 00 57 ff ?? ?? ?? ?? ?? 85 c0 ?? ?? 6a 00 68 04 01 00 00}  //weight: 1, accuracy: Low
        $x_1_2 = {6a 00 6a 00 6a 03 6a 00 6a 07 68 00 00 00 80 ff 35 4c 58 40 00 ff ?? 83 f8 ff ?? ?? 68 ?? ?? ?? ?? e8 ?? ?? ?? ?? 8b 35 60 5a 40 00 0f 57 c0 8b ?? ?? ?? ?? ?? 83 c4 04}  //weight: 1, accuracy: Low
        $x_1_3 = {83 c4 04 8b f8 ?? ?? ?? ?? 50 ?? ?? ?? ?? ?? 6a 04 6a 00 ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 85 c0}  //weight: 1, accuracy: Low
        $x_1_4 = {8b 44 24 14 83 c4 08 8b 08 57 ?? ?? ?? ?? ?? 50 ff ?? ?? 85 c0}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

rule Exploit_Win32_CVE_2023_21752_D_2147901747_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/CVE-2023-21752.D"
        threat_id = "2147901747"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "CVE-2023-21752"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {c7 43 24 01 00 18 00 ff ?? 6a 00 6a 00 6a 00 6a 00 89 43 3c ff ?? 8b ?? ?? ?? ?? ?? 89 43 14 89 3b 83 ff ff ?? ?? 6a 00 53 ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 89 43 40 85 c0 ?? ?? 6a 00 ff 73 14 50 ff ?? ?? ?? ?? 50 6a 00 6a 18 ?? ?? ?? 50 6a 0c 8d 43 18 50 68 40 02 09 00 ff 33 ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 3d e5 03 00 00}  //weight: 1, accuracy: Low
        $x_1_2 = {6a 00 68 80 00 00 00 6a 02 6a 00 6a 07 68 00 00 00 40 50 ff ?? ?? ?? ?? ?? 6a 00 6a 00 ff 35 b4 6a 40 00 8b f0 ff 35 b0 6a 40 00 56 ff ?? ?? ?? ?? ?? 85 c0 ?? ?? ?? ?? ?? b9 ?? ?? ?? ?? 0f 45 ca 51 e8 ?? ?? ?? ?? 83 c4 04 56 8b ?? ?? ?? ?? ?? ff ?? 57 ff ?? e8 ?? ?? ?? ?? 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? 6a 0f ff ?? ?? ?? ?? ?? 85 c0}  //weight: 1, accuracy: Low
        $x_1_3 = {33 c5 89 45 fc 56 6a 00 ff ?? ?? ?? ?? ?? 68 a8 00 00 00 ff ?? ?? ?? ?? ?? 83 c4 04 8b f0 ?? ?? ?? 50 ?? ?? ?? ?? ?? 6a 04 6a 00 ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 85 c0}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

