rule Exploit_Win32_Siveras_A_2147582702_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/Siveras.A"
        threat_id = "2147582702"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "Siveras"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {05 00 0b 03 10 00 00 00 48 00 00 00 01 00 00 00 b8 10 b8 10 00 00 00 00 01 00 00 00 00 00 01 00 a4 c2 ab 50 4d 57 b3 40 9d 66 ee 4f d5 fb a0 76 05 00 00 00 04 5d 88 8a eb 1c c9 11 9f e8 08 00 2b 10 48 60 02 00 00 00}  //weight: 10, accuracy: High
        $x_5_2 = {05 00 00 03 10 00 00 00 [0-2] 00 00 01 00 00 00 [0-2] 00 00}  //weight: 5, accuracy: Low
        $x_10_3 = {8b 6c 24 24 8b 45 3c 8b 7c 05 78 01 ef 8b 4f 18 8b 5f 20 01 eb 49 8b 34 8b 01 ee 31 c0 99 ac 84 c0 74 07 c1 ca 0d 01 c2 eb f4 3b 54 24 28 75 e5 8b 5f 24 01 eb 66 8b 0c 4b 8b 5f 1c 01 eb 03 2c 8b 89 6c 24 1c 61 c3 31 db 64 8b 43 30 8b 40 0c 8b 70 1c ad 8b 40 08 5e 68 8e 4e 0e ec 50 ff d6 66 53 66 68 33 32}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (
            ((1 of ($x_10_*) and 1 of ($x_5_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Exploit_Win32_Siveras_A_2147582702_1
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/Siveras.A"
        threat_id = "2147582702"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "Siveras"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {05 00 0b 03 10 00 00 00 48 00 00 00 01 00 00 00 [0-4] 00 00 00 00 01 00 00 00 00 00 01 00 a4 c2 ab 50 4d 57 b3 40 9d 66 ee 4f d5 fb a0 76 05 00 00 00 04 5d 88 8a eb 1c c9 11 9f e8 08 00 2b 10 48 60 02 00 00 00}  //weight: 10, accuracy: Low
        $x_5_2 = {05 00 00 03 10 00 00 00 [0-2] 00 00 01 00 00 00 [0-2] 00 00}  //weight: 5, accuracy: Low
        $x_10_3 = {8b 6c 24 24 8b 45 3c 8b 7c 05 78 01 ef 8b 4f 18 8b 5f 20 01 eb 49 8b 34 8b 01 ee 31 c0 99 ac 84 c0 74 07 c1 ca 0d 01 c2 eb f4 3b 54 24 28 75 e5 8b 5f 24 01 eb 66 8b 0c 4b 8b 5f 1c 01 eb 03 2c 8b 89 6c 24 1c 61 c3 31 db 64 8b 43 30 8b 40 0c 8b 70 1c ad 8b 40 08 5e 68 8e 4e 0e ec 50 ff d6 66 53 66 68 33 32}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (
            ((1 of ($x_10_*) and 1 of ($x_5_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Exploit_Win32_Siveras_D_2147582752_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/Siveras.D"
        threat_id = "2147582752"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "Siveras"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "25"
        strings_accuracy = "Low"
    strings:
        $x_20_1 = {05 00 0b 03 10 00 00 00 48 00 00 00 01 00 00 00 [0-4] 00 00 00 00 01 00 00 00 00 00 01 00 a4 c2 ab 50 4d 57 b3 40 9d 66 ee 4f d5 fb a0 76 05 00 00 00 04 5d 88 8a eb 1c c9 11 9f e8 08 00 2b 10 48 60 02}  //weight: 20, accuracy: Low
        $x_5_2 = {8b 75 3c 8b 74 35 78 03 f5 56 8b 76 20 03 f5 33 c9 49 41 ad}  //weight: 5, accuracy: High
        $x_5_3 = {75 72 6c 6d 6f 6e 2e 64 6c 6c 00 43 3a 5c [0-5] 2e 65 78 65}  //weight: 5, accuracy: Low
        $x_5_4 = {74 08 c1 cb 0d 03 da 40 eb ef 3b df 75 e7}  //weight: 5, accuracy: High
        $x_2_5 = "\\\\%s\\ipc$" ascii //weight: 2
        $x_2_6 = "\\\\%s\\pipe\\browser" ascii //weight: 2
        $x_1_7 = "exploit" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (
            ((1 of ($x_20_*) and 2 of ($x_2_*) and 1 of ($x_1_*))) or
            ((1 of ($x_20_*) and 1 of ($x_5_*))) or
            (all of ($x*))
        )
}

rule Exploit_Win32_Siveras_E_2147582766_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/Siveras.E"
        threat_id = "2147582766"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "Siveras"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "15"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {05 00 0b 03 10 00 00 00 48 00 00 00 01 00 00 00 b8 10 b8 10 00 00 00 00 01 00 00 00 00 00 01 00 6a 28 19 39 0c b1 d0 11 9b a8 00 c0 4f d9 2e f5 00 00 00 00 04 5d 88 8a eb 1c c9 11 9f e8 08 00 2b 10 48 60 02 00 00 00}  //weight: 10, accuracy: High
        $x_2_2 = "\\\\%s\\pipe\\browser" ascii //weight: 2
        $x_2_3 = "Sending payload2...finish" ascii //weight: 2
        $x_3_4 = "Sending payload1...finish" ascii //weight: 3
        $x_3_5 = "waitting connections ..." ascii //weight: 3
        $x_5_6 = {05 00 00 03 10 00 00 00 [0-2] 00 00 01 00 00 00 [0-2] 00 00}  //weight: 5, accuracy: Low
        $x_10_7 = {8b 6c 24 24 8b 45 3c 8b 7c 05 78 01 ef 8b 4f 18 8b 5f 20 01 eb 49 8b 34 8b 01 ee 31 c0 99 ac 84 c0 74 07 c1 ca 0d 01 c2 eb f4 3b 54 24 28 75 e5 8b 5f 24 01 eb 66 8b 0c 4b 8b 5f 1c 01 eb 03 2c 8b 89 6c 24 1c 61 c3 31 db 64 8b 43 30 8b 40 0c 8b 70 1c ad 8b 40 08 5e 68 8e 4e 0e ec 50 ff d6 66 53 66 68 33 32}  //weight: 10, accuracy: High
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (
            ((1 of ($x_5_*) and 2 of ($x_3_*) and 2 of ($x_2_*))) or
            ((1 of ($x_10_*) and 1 of ($x_3_*) and 1 of ($x_2_*))) or
            ((1 of ($x_10_*) and 2 of ($x_3_*))) or
            ((1 of ($x_10_*) and 1 of ($x_5_*))) or
            ((2 of ($x_10_*))) or
            (all of ($x*))
        )
}

rule Exploit_Win32_Siveras_F_2147605732_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/Siveras.F"
        threat_id = "2147605732"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "Siveras"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "11"
        strings_accuracy = "Low"
    strings:
        $x_10_1 = {33 c9 89 4c 24 09 89 4c 24 0d 89 4c 24 11 83 ca ff c6 44 24 08 00 88 4c 24 15 66 8b 0d ?? ?? ?? ?? 89 54 24 08 68 99 99 00 00 66 89 54 24 10 89 44 24 12 66 89 4c 24 16 ff d6 6a 0e 8d 54 24 0c 66 89 44 24 18 a1 ?? ?? ?? ?? 52 50 e8 ?? ?? 00 00 8b 0d ?? ?? ?? ?? 83 c4 0c 68 60 ea 00 00 51 ff d7 85 c0 75 95}  //weight: 10, accuracy: Low
        $x_1_2 = "Oh shit, the arp spoof already exist, done it ..." ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

