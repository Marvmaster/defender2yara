rule Exploit_Win32_CVE_2021_1675_ZZ_2147797928_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/CVE-2021-1675.ZZ"
        threat_id = "2147797928"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "CVE-2021-1675"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "7"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "CVE-2021-1675-LPE.pdb" ascii //weight: 1
        $x_1_2 = {4c 00 6f 00 63 00 61 00 6c 00 41 00 63 00 63 00 6f 00 75 00 6e 00 74 00 54 00 6f 00 6b 00 65 00 6e 00 46 00 69 00 6c 00 74 00 65 00 72 00 50 00 6f 00 6c 00 69 00 63 00 79}  //weight: 1, accuracy: High
        $x_1_3 = {53 00 4f 00 46 00 54 00 57 00 41 00 52 00 45 00 5c 00 4d 00 69 00 63 00 72 00 6f 00 73 00 6f 00 66 00 74 00 5c 00 57 00 69 00 6e 00 64 00 6f 00 77 00 73 00 5c 00 43 00 75 00 72 00 72 00 65 00 6e 00 74 00 56 00 65 00 72 00 73 00 69 00 6f 00 6e 00 5c 00 50 00 6f 00 6c 00 69 00 63 00 69 00 65 00 73 00 5c 00 53 00 79 00 73 00 74 00 65 00 6d}  //weight: 1, accuracy: High
        $x_1_4 = {63 00 6d 00 64 00 2e 00 65 00 78 00 65 00 20 00 2f 00 43 00 20 00 70 00 69 00 6e 00 67 00 20 00 31 00 2e 00 31 00 2e 00 31 00 2e 00 31 00 20 00 2d 00 6e 00 20 00 31 00 20 00 2d 00 77}  //weight: 1, accuracy: High
        $x_1_5 = {6e 00 74 00 70 00 72 00 69 00 6e 00 74 00 2e 00 69 00 6e 00 66 00 5f 00 61 00 6d 00 64 00 36 00 34}  //weight: 1, accuracy: High
        $x_1_6 = "AddPrinterDriverExW" ascii //weight: 1
        $x_1_7 = {55 00 4e 00 49 00 44 00 52 00 56 00 2e 00 44 00 4c 00 4c}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

rule Exploit_Win32_CVE_2021_1675_A_2147901390_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Win32/CVE-2021-1675.A"
        threat_id = "2147901390"
        type = "Exploit"
        platform = "Win32: Windows 32-bit platform"
        family = "CVE-2021-1675"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "4"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {8b ec 83 ec 34 ?? ?? ?? ?? ?? 33 c5 89 45 fc 53 56 57 ?? ?? ?? c7 45 d8 ff ff ff ff 50 33 ff 33 db 6a 28 89 7d dc ff ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 8b 35 e4 30 40 00 85 c0}  //weight: 1, accuracy: Low
        $x_1_2 = {8b 47 08 f3 0f 7e 07 89 45 f8 ?? ?? ?? 50 6a 00 ?? ?? ?? 66 0f d6 45 f0 50 6a 00 c7 45 d4 00 00 00 00 ff ?? ?? ?? ?? ?? 85 c0}  //weight: 1, accuracy: Low
        $x_1_3 = {8b f8 83 c4 04 89 7c 24 18 85 ff ?? ?? ff 74 24 4c 68 28 48 40 00 68 04 01 00 00 57 e8 ?? ?? ?? ?? 83 c4 10 ?? ?? ?? ?? 6a 01 50 ff ?? ?? ?? ?? ?? 85 c0}  //weight: 1, accuracy: Low
        $x_1_4 = {6a 44 33 ff c7 45 f0 ff ff ff ff ?? ?? ?? c7 45 f8 ff ff ff ff 0f 57 c0 33 db 57 50 8b f1 89 5d f4 0f 11 45 e0 e8 ?? ?? ?? ?? 83 c4 0c 56 ff 15 1c 30 40 00 85 c0}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

