rule VirTool_Win32_Injeshimesz_A_2147919105_0
{
    meta:
        author = "defender2yara"
        detection_name = "VirTool:Win32/Injeshimesz.A!MTB"
        threat_id = "2147919105"
        type = "VirTool"
        platform = "Win32: Windows 32-bit platform"
        family = "Injeshimesz"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {56 6a 00 6a 00 ?? ?? ?? ?? c7 44 24 1c 00 00 00 00 50 0f 57 c0 ?? ?? ?? ?? 68 03 00 1f 00 0f 29 44 24 30 8b f1 50 66 0f d6 44 24 44 c7 44 24 34 18 00 00 00 ?? ?? ?? ?? ?? ?? 85 c0}  //weight: 1, accuracy: Low
        $x_1_2 = {83 3d 28 01 44 00 07 ?? ?? ?? ?? ?? ?? 51 6a 00 6a 00 6a 00 6a 01 6a 04 b8 14 01 44 00 0f 47 05 14 01 44 00 6a 03 50 ?? ?? ?? ?? ?? ?? 8b f8 83 ff ff}  //weight: 1, accuracy: Low
        $x_1_3 = {8b 4d a0 e8 ?? ?? ?? ?? 84 c0 [0-17] b9 40 f4 43 00 ?? ?? ?? ?? ?? 50 ?? ?? ?? ?? ?? 51 [0-16] b9 40 f4 43 00 [0-16] 8b c8}  //weight: 1, accuracy: Low
        $x_1_4 = {c6 45 fc 05 ?? ?? ?? ?? ?? ?? ?? ?? 85 db [0-34] b9 40 f4 43 00 ?? ?? ?? ?? ?? 50 ?? ?? ?? ?? ?? 83 c4 04 6a 00 6a 00 6a 00 68 c0 45 40 00 6a 00 6a 00 ?? ?? ?? ?? ?? ?? 8b f8 ff 75 a0}  //weight: 1, accuracy: Low
        $x_1_5 = {51 0f 47 85 d8 fb ff ff ?? ?? ?? ?? ?? ?? 51 6a 00 6a 00 6a 00 50 6a 00 6a 02 ff b5 8c fb ff ff ?? ?? ?? ?? ?? ?? b9 40 f4 43 00 85 c0}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

rule VirTool_Win32_Injeshimesz_B_2147919107_0
{
    meta:
        author = "defender2yara"
        detection_name = "VirTool:Win32/Injeshimesz.B!MTB"
        threat_id = "2147919107"
        type = "VirTool"
        platform = "Win32: Windows 32-bit platform"
        family = "Injeshimesz"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {56 57 6a 04 68 00 30 00 00 68 c0 11 00 00 8b f9 8b f2 6a 00 57 ?? ?? ?? ?? ?? ?? 89 45 dc 85 c0 ?? ?? ?? ?? ?? ?? 6a 00 68 c0 11 00 00 56 50 57 ?? ?? ?? ?? ?? ?? 85 c0}  //weight: 1, accuracy: Low
        $x_1_2 = {6a 00 6a 18 ?? ?? ?? 0f 57 c0 50 6a 00 57 0f 11 45 e0 66 0f d6 45 f0 ?? ?? ?? ?? ?? ?? 8b f0 85 f6}  //weight: 1, accuracy: Low
        $x_1_3 = {66 89 45 d4 ?? ?? ?? ?? ?? ff 75 b8 ?? ?? ?? c6 45 fc 02 6a 43 ?? ?? ?? ?? ?? 83 ec 08 ?? ?? ?? ?? ?? 83 c4 08 ?? ?? ?? ?? ?? b9 e8 82 43 00 ?? ?? ?? ?? ?? 83 3d dc 7a 43 00 07 ?? ?? ?? ?? ?? ff 35 d8 7a 43 00 0f 47 15 c8 7a 43 00 8b c8}  //weight: 1, accuracy: Low
        $x_1_4 = {83 7d ec 07 ?? ?? ?? 6a 00 0f 47 45 d8 68 80 00 00 00 6a 02 6a 00 6a 00 68 00 00 00 c0 50 ?? ?? ?? ?? ?? ?? 8b f8 83 ff ff ?? ?? ?? ?? ?? ?? 6a 00 6a 00 ff 75 cc ff 75 d0 57}  //weight: 1, accuracy: Low
        $x_1_5 = {55 8b ec 83 e4 f8 83 ec 14 a1 40 70 43 00 33 c4 89 44 24 10 53 56 57 ?? ?? ?? ?? 8b fa 50 8b f1 ?? ?? ?? ?? ?? ?? 85 c0 ?? ?? ?? ?? ?? ?? 83 ec 10 ?? ?? ?? ?? 8b d7 50}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

