rule TrojanDownloader_Win32_Runner_SIB_2147794043_0
{
    meta:
        author = "defender2yara"
        detection_name = "TrojanDownloader:Win32/Runner.SIB!MTB"
        threat_id = "2147794043"
        type = "TrojanDownloader"
        platform = "Win32: Windows 32-bit platform"
        family = "Runner"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_PEHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_50_1 = {78 00 3d 00 27 00 57 00 69 00 6e 00 48 00 74 00 74 00 70 00 27 00 3b 00 [0-10] 78 00 3d 00 6e 00 65 00 77 00 20 00 41 00 63 00 74 00 69 00 76 00 65 00 58 00 4f 00 62 00 6a 00 65 00 63 00 74 00 28 00 78 00 2b 00 27 00 2e 00 27 00 2b 00 78 00 2b 00 27 00 52 00 65 00 71 00 75 00 65 00 73 00 74 00 2e 00 35 00 2e 00 31 00 27 00 29 00 3b 00 [0-10] 78 00 2e 00 6f 00 70 00 65 00 6e 00 28 00 27 00 47 00 45 00 54 00 27 00 2c 00 79 00 5b 00 31 00 5d 00 2b 00 27 00 26 00 61 00 3d 00 27 00 2b 00 65 00 73 00 63 00 61 00 70 00 65 00 28 00 77 00 69 00 6e 00 64 00 6f 00 77 00 2e 00 6e 00 61 00 76 00 69 00 67 00 61 00 74 00 6f 00 72 00 2e 00 75 00 73 00 65 00 72 00 41 00 67 00 65 00 6e 00 74 00 29 00 2c 00 21 00 31 00 29 00}  //weight: 50, accuracy: Low
        $x_50_2 = {78 3d 27 57 69 6e 48 74 74 70 27 3b [0-10] 78 3d 6e 65 77 20 41 63 74 69 76 65 58 4f 62 6a 65 63 74 28 78 2b 27 2e 27 2b 78 2b 27 52 65 71 75 65 73 74 2e 35 2e 31 27 29 3b [0-10] 78 2e 6f 70 65 6e 28 27 47 45 54 27 2c 79 5b 31 5d 2b 27 26 61 3d 27 2b 65 73 63 61 70 65 28 77 69 6e 64 6f 77 2e 6e 61 76 69 67 61 74 6f 72 2e 75 73 65 72 41 67 65 6e 74 29 2c 21 31 29}  //weight: 50, accuracy: Low
        $x_50_3 = {78 00 2e 00 73 00 65 00 6e 00 64 00 28 00 29 00 3b 00 [0-10] 79 00 3d 00 27 00 69 00 70 00 74 00 2e 00 53 00 27 00 3b 00 [0-10] 6e 00 65 00 77 00 20 00 41 00 63 00 74 00 69 00 76 00 65 00 58 00 4f 00 62 00 6a 00 65 00 63 00 74 00 28 00 27 00 57 00 53 00 63 00 72 00 27 00 2b 00 79 00 2b 00 27 00 68 00 65 00 6c 00 6c 00 27 00 29 00 2e 00 52 00 75 00 6e 00 28 00 75 00 6e 00 65 00 73 00 63 00 61 00 70 00 65 00 28 00 75 00 6e 00 65 00 73 00 63 00 61 00 70 00 65 00 28 00 78 00 2e 00 72 00 65 00 73 00 70 00 6f 00 6e 00 73 00 65 00 54 00 65 00 78 00 74 00 29 00 29 00 2c 00 30 00 2c 00 21 00 32 00 29 00}  //weight: 50, accuracy: Low
        $x_50_4 = {78 2e 73 65 6e 64 28 29 3b [0-10] 79 3d 27 69 70 74 2e 53 27 3b [0-10] 6e 65 77 20 41 63 74 69 76 65 58 4f 62 6a 65 63 74 28 27 57 53 63 72 27 2b 79 2b 27 68 65 6c 6c 27 29 2e 52 75 6e 28 75 6e 65 73 63 61 70 65 28 75 6e 65 73 63 61 70 65 28 78 2e 72 65 73 70 6f 6e 73 65 54 65 78 74 29 29 2c 30 2c 21 32 29}  //weight: 50, accuracy: Low
        $x_5_5 = {89 f7 89 f0 81 c7 ?? ?? ?? ?? 81 2e ?? ?? ?? ?? 83 c6 ?? 39 fe 7c ?? bb 00 00 00 00 53 50 e8 ?? ?? ?? ?? e9}  //weight: 5, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (
            ((1 of ($x_5_*))) or
            ((1 of ($x_50_*))) or
            (all of ($x*))
        )
}

