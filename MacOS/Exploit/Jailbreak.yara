rule Exploit_MacOS_Jailbreak_T_2147793722_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:MacOS/Jailbreak.T!MTB"
        threat_id = "2147793722"
        type = "Exploit"
        platform = "MacOS: "
        family = "Jailbreak"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACHOHSTR_EXT"
        threshold = "6"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "/var/mobile/Media/Downloads/OsirisJailbreak" ascii //weight: 1
        $x_1_2 = "tfpzero" ascii //weight: 1
        $x_1_3 = "/exploit/voucher_swap/platform_match.c" ascii //weight: 1
        $x_1_4 = "/exploit/voucher_swap/platform.c" ascii //weight: 1
        $x_1_5 = "/exploit/voucher_swap/log.c" ascii //weight: 1
        $x_1_6 = "/exploit/voucher_swap/voucher_swap.c" ascii //weight: 1
        $x_1_7 = "/exploit/voucher_swap/kernel_alloc.c" ascii //weight: 1
        $x_1_8 = "/exploit/voucher_swap/kernel_slide.c" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        ((uint32(0) == 0xfeedfacf) or (uint32(0) == 0xcffaedfe) or (uint32(0) == 0xfeedface) or (uint32(0) == 0xcefaedfe)) and
        (6 of ($x*))
}

rule Exploit_MacOS_Jailbreak_TB_2147814205_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:MacOS/Jailbreak.TB!MTB"
        threat_id = "2147814205"
        type = "Exploit"
        platform = "MacOS: "
        family = "Jailbreak"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACHOHSTR_EXT"
        threshold = "5"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {2f 6e 6f 6e 63 65 73 65 74 [0-16] 2e 70 6c 69 73 74}  //weight: 1, accuracy: Low
        $x_1_2 = "IOSurfaceRoot" ascii //weight: 1
        $x_1_3 = "fake_kernel_task_kaddr" ascii //weight: 1
        $x_1_4 = "/dev/disk0s1s1" ascii //weight: 1
        $x_1_5 = "safe_fake_tfp0" ascii //weight: 1
        $x_1_6 = "voucher_swap" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        ((uint32(0) == 0xfeedfacf) or (uint32(0) == 0xcffaedfe) or (uint32(0) == 0xfeedface) or (uint32(0) == 0xcefaedfe)) and
        (5 of ($x*))
}

