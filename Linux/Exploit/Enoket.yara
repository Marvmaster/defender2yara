rule Exploit_Linux_Enoket_A_2147769359_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Linux/Enoket.A!MTB"
        threat_id = "2147769359"
        type = "Exploit"
        platform = "Linux: Linux platform"
        family = "Enoket"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_ELFHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "exploit.c" ascii //weight: 1
        $x_1_2 = "/boot/System.map-%s" ascii //weight: 1
        $x_1_3 = "Got ring0" ascii //weight: 1
        $x_1_4 = "Failed to exec rootshell" ascii //weight: 1
        $x_1_5 = "kallsyms_is_hidden" ascii //weight: 1
        $x_1_6 = "SMEP detected, this exploit will very likely fail on recent kernels" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (uint32(0) == 0x464c457f) and
        (2 of ($x*))
}

rule Exploit_Linux_Enoket_A_2147824592_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Linux/Enoket.A!xp"
        threat_id = "2147824592"
        type = "Exploit"
        platform = "Linux: Linux platform"
        family = "Enoket"
        severity = "Critical"
        info = "xp: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_ELFHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {42 03 d0 20 1c ff f7 97 ff 06 e0 00 29 01 d0 13 68 0b 60 63 68 04 33 63 60 20 68 40 19 38 bd 00 48 70 47 ef be ed da 1d 4b f0 b5 1d 1c 1d 49 1d 48 1e 4c 1e 4e 1a 68 8a 42 14 d1 5a 68 82 42 11 d1}  //weight: 1, accuracy: High
        $x_1_2 = {68 a2 42 0e d1 da 68 b2 42 0b d1 19 4a 1f 69 97 42 07 d1 5a 1e 12 78 00 2a 03 d1 c2 24 0f 4a 24 06 05 e0 c2 22 01 33 12}  //weight: 1, accuracy: High
        $x_1_3 = {09 06 b1 42 0d d1 12 05 12 0d 80 2a 09 d9 00 2b 09 d0 69 46 49 0b 49 03 c9 68 8a 58 00 21 d1 50 01 e0 04 30 e8 e7 01}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (uint32(0) == 0x464c457f) and
        (2 of ($x*))
}

rule Exploit_Linux_Enoket_B_2147824655_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Linux/Enoket.B!xp"
        threat_id = "2147824655"
        type = "Exploit"
        platform = "Linux: Linux platform"
        family = "Enoket"
        severity = "Critical"
        info = "xp: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_ELFHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {24 68 23 68 00 2b 0d d1 08 4a 28 1c 10 23 7a 44 10 32 09 f0 84 fc 00 28 04 d0 29 1c 00 f0 09 fb 20 60 01 20 38 bd 44 5d 01 00}  //weight: 1, accuracy: High
        $x_1_2 = {33 00 94 04 f0 12 f9 03 28 0f d1 20 1c 03 99 09 f0}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (uint32(0) == 0x464c457f) and
        (all of ($x*))
}

rule Exploit_Linux_Enoket_C_2147825979_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Linux/Enoket.C!xp"
        threat_id = "2147825979"
        type = "Exploit"
        platform = "Linux: Linux platform"
        family = "Enoket"
        severity = "Critical"
        info = "xp: an internal category used to refer to some threats"
        signature_type = "SIGNATURE_TYPE_ELFHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "[+] Resolved %s to %p%s" ascii //weight: 1
        $x_1_2 = "[*] Triggering payload..." ascii //weight: 1
        $x_1_3 = "[*] Exploit failed to get root." ascii //weight: 1
        $x_1_4 = "[*] Got root" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (uint32(0) == 0x464c457f) and
        (3 of ($x*))
}

rule Exploit_Linux_Enoket_D_2147921113_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Linux/Enoket.D!MTB"
        threat_id = "2147921113"
        type = "Exploit"
        platform = "Linux: Linux platform"
        family = "Enoket"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_ELFHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {55 48 89 e5 53 48 83 ec 08 80 3d f0 0c 20 00 00 75 44 b8 f8 13 60 00 48 2d f0 13 60 00 48 c1 f8 03 48 8d 58 ff 48 8b 05 cc 0c 20 00 48 39 c3 76 1e}  //weight: 1, accuracy: High
        $x_1_2 = {55 48 89 e5 53 bb e0 13 60 00 48 83 ec 08 48 8b 05 eb 02 20 00 48 83 f8 ff 74 14 0f 1f 44 00 00 48 83 eb 08 ff d0 48 8b 03 48 83 f8 ff 75 f1}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (uint32(0) == 0x464c457f) and
        (all of ($x*))
}

rule Exploit_Linux_Enoket_E_2147926019_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Linux/Enoket.E!MTB"
        threat_id = "2147926019"
        type = "Exploit"
        platform = "Linux: Linux platform"
        family = "Enoket"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_ELFHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {31 ed 49 89 d1 5e 48 89 e2 48 83 e4 f0 50 54 49 c7 c0 f0 12 40 00 48 c7 c1 00 13 40 00 48 c7 c7 51 10 40 00 e8 ?? ?? ?? ?? f4}  //weight: 1, accuracy: Low
        $x_1_2 = {55 48 89 e5 53 48 83 ec 08 80 3d 68 15 20 00 00 75 ?? bb 30 1e 60 00 48 8b 05 62 15 20 00 48 81 eb 28 1e 60 00 48 c1 fb 03 48 83 eb 01 48 39 d8 73 ?? 66 0f 1f 44 00 00}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (uint32(0) == 0x464c457f) and
        (all of ($x*))
}

