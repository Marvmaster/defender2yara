rule Trojan_MSIL_Gentromal_B_2147734623_0
{
    meta:
        author = "defender2yara"
        detection_name = "Trojan:MSIL/Gentromal.B"
        threat_id = "2147734623"
        type = "Trojan"
        platform = "MSIL: .NET intermediate language scripts"
        family = "Gentromal"
        severity = "Critical"
        signature_type = "SIGNATURE_TYPE_PEHSTR"
        threshold = "8"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "BruteActiveX.Properties.Resources.resources" ascii //weight: 1
        $x_1_2 = "wfreerdp.dll" ascii //weight: 1
        $x_1_3 = "service.pdb" ascii //weight: 1
        $x_1_4 = {1b 30 06 00 c5 02 00 00 04 00 00 11 2b 09 28 29 9d 27 34 14 16 9a 26 16 2d f9 16 28 0f 00 00 06 17 0a 20 3d 0d 00 00 0b 20 60 ea 00 00 0c 72 01 00 00 70 0d 17 13 04 72 01 00 00 70 13 05 72 01 00 00 70 13 06 16 13 07 38 c2 01 00 00 02 11 07 9a 6f 13 00 00 0a 13 08 02 11 07 17 58 9a 6f 13 00 00 0a 13 09 11 08 25 13 0c 39 9a 01 00 00 fe 13 7e 0d 00 00 04 3a cb 00 00 00 1f 0b 73 53 00 00 0a 25 20 7c 00 00 00 28 2c 00 00 06 16 28 54 00 00 0a 25 20 84 00 00 00 28 2c 00 00 06 17 28}  //weight: 1, accuracy: High
        $x_1_5 = {54 00 00 0a 25 20 98 00 00 00 28 2c 00 00 06 18 28 54 00 00 0a 25 20 a0 00 00 00 28 2c 00 00 06 19 28 54 00 00 0a 25 20 ae 00 00 00 28 2c 00 00 06 1a 28 54 00 00 0a 25 20 bc 00 00 00 28 2c 00 00 06 1b 28 54 00 00 0a 25 20 ce 00 00 00 28 2c 00 00 06 1c 28 54 00 00 0a 25 20 d6 00 00 00 28 2c 00 00 06 1d 28 54 00 00 0a 25 20 e6 00 00 00 28 2c 00 00 06 1e 28 54 00 00 0a 25 20 f2 00 00 00 28 2c 00 00 06 1f 09 28 54 00 00 0a 25 20 08 01 00 00 28 2c 00 00 06 1f 0a 28 54 00 00 0a fe}  //weight: 1, accuracy: High
        $x_1_6 = {13 80 0d 00 00 04 fe 13 7e 0d 00 00 04 11 0c 12 0d 28 55 00 00 0a 39 ae 00 00 00 11 0d 45 0b 00 00 00 05 00 00 00 05 00 00 00 14 00 00 00 14 00 00 00 23 00 00 00 23 00 00 00 2b 00 00 00 2b 00 00 00 39 00 00 00 39 00 00 00 47 00 00 00 38 76 00 00 00 11 09 12 02 28 56 00 00 0a 0a 38 67 00 00 00 11 09 12 01 28 56 00 00 0a 0a 38 58 00 00 00 11 09 0d 38 50 00 00 00 11 09 28 57 00 00 0a 13 05 38 42 00 00 00 11 09 28 57 00 00 0a 13 06 38 34 00 00 00 11 09 20 14 01 00 00 28 2c 00 00}  //weight: 1, accuracy: High
        $x_1_7 = {06 28 58 00 00 0a 3a 1b 00 00 00 11 09 6f 59 00 00 0a 20 1a 01 00 00 28 2c 00 00 06 28 58 00 00 0a 38 01 00 00 00 17 13 04 11 07 17 58 13 07 06 39 0c 00 00 00 11 07 02 8e 69 17 59 3f 2c fe ff ff 06 39 0e 00 00 00 09 28 5a 00 00 0a 16 fe 01 38 01 00 00 00 16 0a 06 39 8e 00 00 00 11 04 39 27 00 00 00 28 5b 00 00 0a 16 28 5c 00 00 0a 28 62 00 00 06 09 07 11 05 11 06 11 04 73 02 00 00 06 28 5d 00 00 0a 38 60 00 00 00 72 01 00 00 70 13 0a 11 05 20 26 01 00 00 28 2c 00 00 06 6f 5e}  //weight: 1, accuracy: High
        $x_1_8 = {00 00 0a 13 0b 11 0b 16 3e 19 00 00 00 11 05 16 11 0b 6f 5f 00 00 0a 13 0a 11 05 11 0b 17 58 6f 60 00 00 0a 13 05 09 07 11 0a 11 05 11 06 28 0d 00 00 06 20 00 01 00 00 6a 5e 69 28 0f 00 00 06 dd 06 00 00 00 26 dd 00 00 00 00 28 0e 00 00 06 2a 00 00 00 01 10 00 00 00 00 5f 02 5a b9 02 06 3f 00 00 01}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (uint16(0) == 0x5a4d) and
        (all of ($x*))
}

